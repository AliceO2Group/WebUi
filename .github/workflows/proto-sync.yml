name: Sync proto file from Control core

on:
  schedule:
    - cron: '0 7 * * 1-5'
  workflow_dispatch:

jobs:
  check-proto-changes:
    name: Create a PR in WebUI repo with updated proto file
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        repo-token: ${{ secrets.GITHUB_TOKEN }}
    - name: Copy new proto file(s)
      run: |
        git clone https://github.com/AliceO2Group/Control.git aliecs
        cp aliecs/core/protos/o2control.proto Control/protobuf
        cp aliecs/apricot/protos/apricot.proto Control/protobuf/o2apricot.proto
        rm -rf aliecs
    - name: Check if there are any differences and create PR
      run: |
        is_different="$(git diff --name-only)"
        if [ ! -z "$is_different" ]; then
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add .
          git commit -m "Update PROTO files from AliECS"
          gh pr create --head --fill -r graduta -l "Control"
        fi
